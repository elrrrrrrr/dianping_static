(function(G,D){function mapDo(callbacks){var a;while(a=callbacks.shift()){a()}}function log(msg){if(G.console&&G.console.log){try{G.console.log("hwt:"+msg)}catch(e){}}}var onEvent,offEvent;if(G.addEventListener){onEvent=function(obj,evt,f){obj.addEventListener(evt,f)};offEvent=function(obj,evt,f){obj.removeEventListener(evt,f)}}else{onEvent=function(obj,evt,f){obj.attachEvent("on"+evt,f)};offEvent=function(obj,evt,f){obj.detachEvent(evt,f)}}var _flashSuccessCallbacks=[],_flashFailCallbacks=[],flashJSProxyFn=guid(),FlashStorage={SWF_URL:"http://s.cr-nielsen.com/hwt.swf#",available:1,_jpf:flashJSProxyFn,get:function(name,callback){FlashStorage._sendMsg(callback,"jGetItem",name)},set:function(name,value,callback){FlashStorage._sendMsg(callback,"jSetItem",name,value)},_sendMsg:function(callback,method,name,value){callback=callback||noop;var cbname=guid(),al=arguments.length,swf=FlashStorage.swf;G[cbname]=callback;if(al==2){swf[method](cbname)}else if(al==3){swf[method](name,cbname)}else{if(typeof value!="string"){throw new Error("FlashStorage only support string type value!")}swf[method](name,value,cbname)}},init:function(success,fail){if(!FlashStorage.available){return fail&&fail()}if(FlashStorage.inited){return success&&setTimeout(success,0)}success&&_flashSuccessCallbacks.push(success);fail&&_flashFailCallbacks.push(fail);if(!FlashStorage.loading){loadSWF()}}};function loadSWF(){FlashStorage.loading=1;var Plugin,flashVersion="";try{Plugin=G.navigator.plugins["Shockwave Flash"]||G.ActiveXObject;flashVersion=Plugin.description||new Plugin("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(e){}flashVersion=(flashVersion.match(/\d+/g)||[0])[0];if(flashVersion<10){FlashStorage.available=0;mapDo(_flashFailCallbacks);return}else{FlashStorage.available=1;G[flashJSProxyFn]=function(){var args=arguments;setTimeout(function(){deferCallJS.apply(G,args)},0)};var _tid=setInterval(function(){if(D.body){clearInterval(_tid);createSWF();setTimeout(function(){if(!FlashStorage.inited){FlashStorage.available=0;_flashSuccessCallbacks.length=0;mapDo(_flashFailCallbacks)}},5e3)}},50)}}function deferCallJS(signal,msg){switch(signal){case"onecall":if(!G[msg])return;G[msg].apply(G,[].slice.call(arguments,2));G[msg]=null;break;case"error":FlashStorage.available=FlashStorage.inited=0;mapDo(_flashFailCallbacks);log(msg);break;case"load":log("Flash storage load success!");FlashStorage.available=FlashStorage.inited=1;_flashFailCallbacks.length=0;mapDo(_flashSuccessCallbacks)}}function createSWF(){var ct=D.createElement("div");ct.setAttribute("style","display:block;position:absolute;right:0;bottom:0;border:none;");D.body.insertBefore(ct,D.body.firstChild);ct.innerHTML='<object id="'+guid()+'" data="'+FlashStorage.SWF_URL+'" type="application/x-shockwave-flash" width="10" height="10" style="position:absolute;right:0;bottom:0;"><param name="movie" value="'+FlashStorage.SWF_URL+'" /><param name="wmode" value="transparent" /><param name="version" value="10" /><param name="allowScriptAccess" value="always" /><param name="flashvars" value="jsproxyfunction='+flashJSProxyFn+'" /></object>';FlashStorage.swf=ct.firstChild}var _iframeFailCallbacks=[],_iframeSuccessCallbacks=[];var IFrameStorage={IFRAME_URL:"http://s.cr-nielsen.com/iframe.html",available:G.postMessage&&G.localStorage,init:function(success,fail){if(IFrameStorage.available){if(IFrameStorage.inited){return success&&setTimeout(success,0)}if(!IFrameStorage.loading){IFrameStorage.loading=1;var tid=setInterval(function(){if(D.body){clearInterval(tid);var iframe=D.createElement("iframe");var timeoutTid=setTimeout(function(){iframe.onerror();iframe.parentNode.removeChild(iframe)},5e3);iframe.style.display="none";iframe.src=IFrameStorage.IFRAME_URL;IFrameStorage.origin=iframe.src.split("/").slice(0,3).join("/");function onload(evt){if(evt.origin!=IFrameStorage.origin)return;offEvent(G,"message",onload);if(evt.data=="loaded"){clearTimeout(timeoutTid);IFrameStorage.window=iframe.contentWindow;IFrameStorage.inited=1;mapDo(_iframeSuccessCallbacks)}}onEvent(G,"message",onload);iframe.onerror=iframe.onabort=function(){IFrameStorage.available=false;console.log(_iframeFailCallbacks);mapDo(_iframeFailCallbacks)};D.body.insertBefore(iframe,D.body.firstChild)}},50)}success&&_iframeSuccessCallbacks.push(success);fail&&_iframeFailCallbacks.push(fail)}else{fail&&fail()}},get:function(name,cb){IFrameStorage._sendMsg(cb,"getItem",name)},set:function(name,value,cb){IFrameStorage._sendMsg(cb,"setItem",name,value)},_sendMsg:function(cb,method,name,value){function f(evt){if(evt.origin!=IFrameStorage.origin)return;offEvent(G,"message",f);cb(evt.data)}onEvent(G,"message",f);IFrameStorage.window.postMessage([method,name,value].join("#"),"*")}};function newComboStorage(useStorages){function bulkCall(method,args,onComplete){var i=useStorages.length;var values=[];var restCount=i;function cb(value){values.push(value);restCount--;if(!restCount){onComplete&&onComplete(values)}}args.push(cb);while(st=useStorages[--i]){(function(store){store.init(function(){store[method].apply(G,args)},function(){cb()})})(st)}}return{getOlder:function(key,cb,fail){bulkCall("get",[key],onComplete);function onComplete(values){var i=values.length,v,t,last;while(i--){v=values[i];if(!v)continue;v=v.split("&");if(v.length<2){return cb(v[0])}t=parseInt(v[0],36);if(!last||last[0]>t){last=v}}if(!last){fail&&fail()}else{cb(last[1])}}},setAll:function(key,value,onComplete){value=(+new Date).toString(36)+"&"+value;bulkCall("set",[key,value],onComplete)}}}function guid(){return"_"+(Math.random()*1e18).toString(36).slice(0,5).toUpperCase()}function noop(){}function param(params){var qs=[],k,p;for(k in params){p=params[k];if(p){qs.push(k+"="+p)}}return qs.join("&")}function getJSONP(url,callback){var gid=guid(),s;G[gid]=function(){callback.apply(G,arguments);s.parentNode.removeChild(s);G[gid]=null};url+="&jsonp="+gid;s=getScript(url)}function getScript(url){var s=D.createElement("script"),head=D.getElementsByTagName("head")[0];s.type="text/javascript";s.src=url;head.insertBefore(s,head.firstChild);return s}var _hwt={FlashStorage:FlashStorage,IFrameStorage:IFrameStorage,API_URL:"http://t.hypers.com.cn/cgi-bin/hwt?",track:function(conf,cps){if(conf.SWF_URL){FlashStorage.SWF_URL=conf.SWF_URL}if(conf.IFRAME_URL){IFrameStorage.IFRAME_URL=conf.IFRAME_URL}var stores=[];if(!conf.NO_ILS&&IFrameStorage.available){stores.push(IFrameStorage)}if(!conf.NO_FLS){stores.push(FlashStorage)}if(!stores.length){sendTrack(conf,cps)}else{_hwt.store=newComboStorage(stores);_hwt.store.getOlder("_hid",function(v){sendTrack(conf,cps,v)},function(){sendTrack(conf,cps)})}}};function sendTrack(conf,cps,_hid){var params={_hid:_hid,_UA:conf.UA},ref,l;if(conf.WITH_REF){try{ref=G.top.document.referrer}catch(e){try{ref=G.parent.document.referrer}catch(e){ref=document.referrer}}params.ref=ref}params=param(params);if(cps&&(l=cps.length)){while(l--){cps[l]=encodeURIComponent(cps[l])}params+="&p="+cps}getJSONP((conf.API_URL||_hwt.API_URL)+params,function(v){if(_hwt.store){_hwt.store.setAll("_hid",v)}onceGetIdCallback(v)})}function onceGetIdCallback(hid){var f=G.HWT_ID_READY_CALL_ONCE;if(f){if(typeof f=="function"){f(hid)}else if(typeof G[f]=="function"){G[f](hid)}else{getScript(f)}onceGetIdCallback=noop}}G._hwt=_hwt;if(G._hwtTQ){var q=G._hwtTQ,a;while(a=q.shift()){_hwt.track(a[0],a[1])}G._hwtTQ.push=function(a){_hwt.track(a[0],a[1])}}var _w={$p:function(p){G['_hwt']['track'](_hwt_c,p)}};var HWT=function(a){this.r=1;if(a&&a.length)for(var b=0;b<a.length;b++)this.push(a[b])};"undefined"==typeof window._hq&&(window._hq=[]);HWT.prototype.push=function(a){a=[].slice.apply(a);if(a){if("object"==typeof a&&a.length){if(!_w[a[0]]){console.log(a[0]+'  is not defined');return}_w[a[0]](a[1])}}};window._hq=new HWT(window._hq)})(this,document);